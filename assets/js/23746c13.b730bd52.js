"use strict";(globalThis.webpackChunkkingtech_actions=globalThis.webpackChunkkingtech_actions||[]).push([[162],{2657(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"base-action/Example","title":"Example","description":"Complete CI/CD Pipeline","source":"@site/docs/base-action/2_Example.md","sourceDirName":"base-action","slug":"/base-action/Example","permalink":"/base-action/Example","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/base-action/Overview"},"next":{"title":"Overview","permalink":"/deploy-pages/Overview"}}');var t=s(4848),r=s(8453);const l={sidebar_position:2},c="Example",a={},o=[{value:"Complete CI/CD Pipeline",id:"complete-cicd-pipeline",level:2},{value:"Build and Test Only (No Publishing)",id:"build-and-test-only-no-publishing",level:2},{value:"NuGet Publishing Only",id:"nuget-publishing-only",level:2},{value:"Docker Publishing Only",id:"docker-publishing-only",level:2},{value:"Custom Dockerfile Location",id:"custom-dockerfile-location",level:2},{value:"Private NuGet Feed",id:"private-nuget-feed",level:2},{value:"Multi-Branch Strategy",id:"multi-branch-strategy",level:2},{value:"With Additional Steps",id:"with-additional-steps",level:2},{value:"Setting Up Secrets",id:"setting-up-secrets",level:2},{value:"For Docker Publishing:",id:"for-docker-publishing",level:3},{value:"For NuGet Publishing:",id:"for-nuget-publishing",level:3},{value:"Important Notes",id:"important-notes",level:2},{value:"What Happens Step-by-Step",id:"what-happens-step-by-step",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"example",children:"Example"})}),"\n",(0,t.jsx)(n.h2,{id:"complete-cicd-pipeline",children:"Complete CI/CD Pipeline"}),"\n",(0,t.jsx)(n.p,{children:"The simplest way to use the base-action with full Docker and NuGet publishing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Complete CI/CD Pipeline\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n    steps:\n    # Checkout with full history (required for GitVersion)\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    # Run complete pipeline\n    - name: Build, Test, Version, and Deploy\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        docker_registry_username: ${{ secrets.DOCKERHUB_USERNAME }}\n        docker_registry_password: ${{ secrets.DOCKERHUB_TOKEN }}\n        docker_image_name: "my-app"\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This single action will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Generate a semantic version number using GitVersion"}),"\n",(0,t.jsx)(n.li,{children:"Build all .NET projects with the version number"}),"\n",(0,t.jsx)(n.li,{children:"Run all unit tests and generate a test report"}),"\n",(0,t.jsxs)(n.li,{children:["Publish NuGet packages (projects ending with ",(0,t.jsx)(n.code,{children:".NuGet.csproj"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Build and push a Docker image with multiple tags (",(0,t.jsx)(n.code,{children:"latest"}),", version number, branch tag)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"build-and-test-only-no-publishing",children:"Build and Test Only (No Publishing)"}),"\n",(0,t.jsx)(n.p,{children:"If you only want to build and test without publishing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Build and Test\n\non:\n  pull_request:\n    branches: [ main ]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    # Only build and test (no NuGet/Docker publishing)\n    - name: Build and Test\n      uses: KingTech/KingTech.GithubActions/base-action@main\n"})}),"\n",(0,t.jsx)(n.p,{children:"Without credentials, the action skips NuGet and Docker publishing steps."}),"\n",(0,t.jsx)(n.h2,{id:"nuget-publishing-only",children:"NuGet Publishing Only"}),"\n",(0,t.jsx)(n.p,{children:"Publish NuGet packages without Docker images:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Publish NuGet Packages\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    - name: Build and Publish NuGet\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"docker-publishing-only",children:"Docker Publishing Only"}),"\n",(0,t.jsx)(n.p,{children:"Build and push Docker images without NuGet packages:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Build and Push Docker Image\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  docker:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    - name: Build and Publish Docker\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        docker_registry_username: ${{ secrets.DOCKERHUB_USERNAME }}\n        docker_registry_password: ${{ secrets.DOCKERHUB_TOKEN }}\n        docker_image_name: "my-app"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"custom-dockerfile-location",children:"Custom Dockerfile Location"}),"\n",(0,t.jsx)(n.p,{children:"Use a custom Dockerfile path:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Build with Custom Dockerfile\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    - name: Build and Deploy\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        docker_registry_username: ${{ secrets.DOCKERHUB_USERNAME }}\n        docker_registry_password: ${{ secrets.DOCKERHUB_TOKEN }}\n        docker_image_name: "my-app"\n        docker_file: "docker/production.Dockerfile"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"private-nuget-feed",children:"Private NuGet Feed"}),"\n",(0,t.jsx)(n.p,{children:"Publish to a private NuGet server:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Publish to Private NuGet\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    - name: Build and Publish\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        nuget_api_source: "https://nuget.mycompany.com/v3/index.json"\n        nuget_api_key: ${{ secrets.PRIVATE_NUGET_KEY }}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"multi-branch-strategy",children:"Multi-Branch Strategy"}),"\n",(0,t.jsx)(n.p,{children:"Different behavior for different branches:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Multi-Branch Pipeline\n\non:\n  push:\n    branches: [ main, development, release/* ]\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    # Deploy to production only on main\n    - name: Build and Deploy\n      if: github.ref == 'refs/heads/main'\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        docker_registry_username: ${{ secrets.DOCKERHUB_USERNAME }}\n        docker_registry_password: ${{ secrets.DOCKERHUB_TOKEN }}\n        docker_image_name: \"my-app\"\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n\n    # Only build and test for other branches\n    - name: Build and Test Only\n      if: github.ref != 'refs/heads/main'\n      uses: KingTech/KingTech.GithubActions/base-action@main\n"})}),"\n",(0,t.jsx)(n.h2,{id:"with-additional-steps",children:"With Additional Steps"}),"\n",(0,t.jsx)(n.p,{children:"Combine with other actions before or after:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Extended Pipeline\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with: \n        fetch-depth: 0\n\n    # Pre-processing step\n    - name: Setup custom environment\n      run: |\n        echo "Setting up environment..."\n        # Your custom setup here\n\n    # Run the base action\n    - name: Build, Test, and Deploy\n      uses: KingTech/KingTech.GithubActions/base-action@main\n      with:\n        docker_registry_username: ${{ secrets.DOCKERHUB_USERNAME }}\n        docker_registry_password: ${{ secrets.DOCKERHUB_TOKEN }}\n        docker_image_name: "my-app"\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n\n    # Post-processing step\n    - name: Notify deployment\n      if: success()\n      run: |\n        echo "Deployment successful!"\n        # Send notification, update status, etc.\n'})}),"\n",(0,t.jsx)(n.h2,{id:"setting-up-secrets",children:"Setting Up Secrets"}),"\n",(0,t.jsx)(n.p,{children:"To use this action with publishing enabled, configure these GitHub secrets:"}),"\n",(0,t.jsx)(n.h3,{id:"for-docker-publishing",children:"For Docker Publishing:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/",children:"Docker Hub"})," and create an access token"]}),"\n",(0,t.jsx)(n.li,{children:"In GitHub: Settings \u2192 Secrets and variables \u2192 Actions"}),"\n",(0,t.jsxs)(n.li,{children:["Add secrets:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DOCKERHUB_USERNAME"}),": Your Docker Hub username"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DOCKERHUB_TOKEN"}),": Your Docker Hub access token"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"for-nuget-publishing",children:"For NuGet Publishing:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Get your NuGet API key from ",(0,t.jsx)(n.a,{href:"https://www.nuget.org/",children:"nuget.org"})," (or your private feed)"]}),"\n",(0,t.jsx)(n.li,{children:"In GitHub: Settings \u2192 Secrets and variables \u2192 Actions"}),"\n",(0,t.jsxs)(n.li,{children:["Add secret:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NUGET_API_KEY"}),": Your NuGet API key"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Always use ",(0,t.jsx)(n.code,{children:"fetch-depth: 0"})]})," when checking out to ensure GitVersion can calculate versions correctly"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NuGet projects"})," must end with ",(0,t.jsx)(n.code,{children:".NuGet.csproj"})," for automatic discovery"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Docker tags"})," are automatically generated: ",(0,t.jsx)(n.code,{children:"latest"}),", version number (e.g., ",(0,t.jsx)(n.code,{children:"1.2.3"}),"), and branch tag (e.g., ",(0,t.jsx)(n.code,{children:"alpha"}),", ",(0,t.jsx)(n.code,{children:"beta"}),", ",(0,t.jsx)(n.code,{children:"main"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Optional publishing"}),": Omit credentials to skip NuGet or Docker publishing steps"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test reports"})," are automatically generated and visible in the GitHub Actions UI"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"what-happens-step-by-step",children:"What Happens Step-by-Step"}),"\n",(0,t.jsx)(n.p,{children:"When this action runs:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Version Generation"}),": Uses GitVersion to calculate semantic version based on Git history"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Build & Test"}),": Builds all .NET projects and runs unit tests with the generated version"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test Report"}),": Creates a test report visible in the Actions UI"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NuGet Publishing"})," (if API key provided):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Discovers projects ending with ",(0,t.jsx)(n.code,{children:".NuGet.csproj"})]}),"\n",(0,t.jsx)(n.li,{children:"Packages them with the version number"}),"\n",(0,t.jsx)(n.li,{children:"Pushes to the specified NuGet feed"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Docker Publishing"})," (if credentials provided):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Builds Docker image for AMD64 and ARM64"}),"\n",(0,t.jsxs)(n.li,{children:["Tags with version, branch tag, and ",(0,t.jsx)(n.code,{children:"latest"})]}),"\n",(0,t.jsx)(n.li,{children:"Pushes to Docker registry"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Each publishing step is conditional and only executes if the required credentials are provided."})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);