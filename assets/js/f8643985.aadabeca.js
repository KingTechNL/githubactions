"use strict";(globalThis.webpackChunkkingtech_actions=globalThis.webpackChunkkingtech_actions||[]).push([[930],{6141(e,n,i){i.r(n),i.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"publish-nuget/Example","title":"Example","description":"Auto-Discovery with .NuGet.csproj Convention","source":"@site/docs/publish-nuget/2_Example.md","sourceDirName":"publish-nuget","slug":"/publish-nuget/Example","permalink":"/publish-nuget/Example","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/publish-nuget/Overview"},"next":{"title":"Overview","permalink":"/replace-env/Overview"}}');var t=i(4848),c=i(8453);const r={sidebar_position:2},o="Example",u={},a=[{value:"Auto-Discovery with .NuGet.csproj Convention",id:"auto-discovery-with-nugetcsproj-convention",level:2},{value:"Specifying Explicit Projects",id:"specifying-explicit-projects",level:2},{value:"Publishing to Private NuGet Feed",id:"publishing-to-private-nuget-feed",level:2},{value:"Publishing to GitHub Packages",id:"publishing-to-github-packages",level:2},{value:"Complete Build, Test, and Publish Pipeline",id:"complete-build-test-and-publish-pipeline",level:2},{value:"With Static Version Number",id:"with-static-version-number",level:2},{value:"Setting Up NuGet API Key",id:"setting-up-nuget-api-key",level:2},{value:"Project Naming Convention",id:"project-naming-convention",level:2},{value:"What Happens",id:"what-happens",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"example",children:"Example"})}),"\n",(0,t.jsx)(n.h2,{id:"auto-discovery-with-nugetcsproj-convention",children:"Auto-Discovery with .NuGet.csproj Convention"}),"\n",(0,t.jsxs)(n.p,{children:["The simplest way to use this action is with automatic project discovery. Name your NuGet projects with a ",(0,t.jsx)(n.code,{children:".NuGet.csproj"})," suffix:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Publish NuGet Packages\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    # Checkout repository\n    - uses: actions/checkout@v3\n      with:\n        fetch-depth: 0\n\n    # Get version number\n    - name: Get version\n      id: gitversion\n      uses: KingTech/KingTech.GithubActions/gitversion@main\n\n    # Build and publish all .NuGet.csproj projects\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_version: ${{ steps.gitversion.outputs.version }}\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will automatically find and publish projects like ",(0,t.jsx)(n.code,{children:"MyLibrary.NuGet.csproj"}),", ",(0,t.jsx)(n.code,{children:"Utilities.NuGet.csproj"}),", etc."]}),"\n",(0,t.jsx)(n.h2,{id:"specifying-explicit-projects",children:"Specifying Explicit Projects"}),"\n",(0,t.jsx)(n.p,{children:"Example explicitly specifying which projects to publish:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Publish Specific NuGet Packages\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with:\n        fetch-depth: 0\n\n    - name: Get version\n      id: gitversion\n      uses: KingTech/KingTech.GithubActions/gitversion@main\n\n    # Publish specific projects\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_projects: "src/MyLibrary/MyLibrary.csproj;src/Core/Core.csproj"\n        nuget_version: ${{ steps.gitversion.outputs.version }}\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"publishing-to-private-nuget-feed",children:"Publishing to Private NuGet Feed"}),"\n",(0,t.jsx)(n.p,{children:"Example publishing to a private NuGet server or Azure Artifacts:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Publish to Private Feed\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with:\n        fetch-depth: 0\n\n    - name: Get version\n      id: gitversion\n      uses: KingTech/KingTech.GithubActions/gitversion@main\n\n    # Publish to private NuGet feed\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_version: ${{ steps.gitversion.outputs.version }}\n        nuget_api_source: "https://pkgs.dev.azure.com/myorg/_packaging/myfeed/nuget/v3/index.json"\n        nuget_api_key: ${{ secrets.AZURE_ARTIFACTS_KEY }}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"publishing-to-github-packages",children:"Publishing to GitHub Packages"}),"\n",(0,t.jsx)(n.p,{children:"Example publishing to GitHub Packages NuGet feed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Publish to GitHub Packages\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with:\n        fetch-depth: 0\n\n    - name: Get version\n      id: gitversion\n      uses: KingTech/KingTech.GithubActions/gitversion@main\n\n    # Publish to GitHub Packages\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_version: ${{ steps.gitversion.outputs.version }}\n        nuget_api_source: "https://nuget.pkg.github.com/OWNER/index.json"\n        nuget_api_key: ${{ secrets.GITHUB_TOKEN }}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"OWNER"})," with your GitHub username or organization name."]}),"\n",(0,t.jsx)(n.h2,{id:"complete-build-test-and-publish-pipeline",children:"Complete Build, Test, and Publish Pipeline"}),"\n",(0,t.jsx)(n.p,{children:"Example of a full workflow including build, test, versioning, and publishing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Complete NuGet Pipeline\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  build-and-publish:\n    runs-on: ubuntu-latest\n    steps:\n    # Checkout code\n    - uses: actions/checkout@v3\n      with:\n        fetch-depth: 0\n\n    # Build and test\n    - name: Build and Test\n      uses: KingTech/KingTech.GithubActions/dotnet-build-test@main\n\n    # Get version number\n    - name: Get version\n      id: gitversion\n      uses: KingTech/KingTech.GithubActions/gitversion@main\n\n    # Publish NuGet packages\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_version: ${{ steps.gitversion.outputs.version }}\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"with-static-version-number",children:"With Static Version Number"}),"\n",(0,t.jsx)(n.p,{children:"Example using a static version number (not recommended for production):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: Publish with Static Version\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n\n    - name: Publish NuGet packages\n      uses: KingTech/KingTech.GithubActions/publish-nuget@main\n      with:\n        nuget_version: "1.0.0"\n        nuget_api_key: ${{ secrets.NUGET_API_KEY }}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"setting-up-nuget-api-key",children:"Setting Up NuGet API Key"}),"\n",(0,t.jsx)(n.p,{children:"To use this action, you need to add your NuGet API key as a GitHub secret:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"For NuGet.org:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.a,{href:"https://www.nuget.org/",children:"nuget.org"})," and sign in"]}),"\n",(0,t.jsx)(n.li,{children:"Navigate to your account settings and create an API key"}),"\n",(0,t.jsx)(n.li,{children:"Copy the generated API key"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Add to GitHub:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Go to your GitHub repository Settings \u2192 Secrets and variables \u2192 Actions"}),"\n",(0,t.jsxs)(n.li,{children:["Add a new secret named ",(0,t.jsx)(n.code,{children:"NUGET_API_KEY"})," with your API key as the value"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"For private feeds:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Follow the same process but use your private feed's authentication token"}),"\n",(0,t.jsxs)(n.li,{children:["Name the secret appropriately (e.g., ",(0,t.jsx)(n.code,{children:"AZURE_ARTIFACTS_KEY"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"project-naming-convention",children:"Project Naming Convention"}),"\n",(0,t.jsx)(n.p,{children:"For automatic discovery to work, follow this naming pattern:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Publishable projects:"})," ",(0,t.jsx)(n.code,{children:"MyLibrary.NuGet.csproj"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Regular projects:"})," ",(0,t.jsx)(n.code,{children:"MyLibrary.csproj"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This allows the action to distinguish between projects meant for NuGet publishing and regular projects."}),"\n",(0,t.jsx)(n.h2,{id:"what-happens",children:"What Happens"}),"\n",(0,t.jsx)(n.p,{children:"When this action runs, it will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Discover NuGet projects (either automatically or from the specified list)"}),"\n",(0,t.jsx)(n.li,{children:"Setup .NET SDK (supports .NET 3.1, 5.0, 6.0+)"}),"\n",(0,t.jsx)(n.li,{children:"Build all projects with the specified version number"}),"\n",(0,t.jsx)(n.li,{children:"Create NuGet packages (.nupkg files) for each project"}),"\n",(0,t.jsx)(n.li,{children:"Push the packages to the specified NuGet feed"}),"\n",(0,t.jsxs)(n.li,{children:["Skip packages that already exist (using ",(0,t.jsx)(n.code,{children:"--skip-duplicate"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The published packages will be available on your NuGet feed and can be installed using ",(0,t.jsx)(n.code,{children:"dotnet add package <PackageName>"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453(e,n,i){i.d(n,{R:()=>r,x:()=>o});var s=i(6540);const t={},c=s.createContext(t);function r(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);